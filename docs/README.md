# Documentation

Welcome to the `promptext-notes` documentation!

## For Users

**[ðŸ“š Usage Guide](USAGE.md)** - Complete guide to using the tool

- Installation
- Configuration
- Local usage (manual, git hooks)
- GitHub Actions integration
- Examples and best practices

**[âš™ï¸ Configuration Reference](CONFIGURATION.md)** - Detailed config file reference

- AI provider settings
- 2-stage polish workflow
- File filtering (`auto_exclude_meta` and more)
- Output configuration
- Complete examples for different use cases

---

## For Contributors

### Project Architecture

**promptext-notes** is a CLI tool that generates AI-enhanced release notes from git history and code changes.

#### Key Features (v0.8.0)

1. **Multi-Provider AI Support** - Cerebras, OpenAI, Anthropic, Groq, OpenRouter, Ollama
2. **2-Stage Polish Workflow** - Discovery (code analysis) + Polish (language refinement)
3. **Auto-Exclude-Meta Filtering** - Keeps changelogs focused on user-facing changes
4. **Configuration File** - YAML-based with sensible defaults
5. **GitHub Actions Integration** - Automated release notes on tag push

#### Architecture Overview

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                           CLI Entry                             â”‚
â”‚                  cmd/promptext-notes/main.go                    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                             â”‚
                             â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                      Workflow Orchestration                     â”‚
â”‚                  internal/workflow/workflow.go                  â”‚
â”‚                                                                 â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚ Stage 1: Discovery (analyze code changes)               â”‚  â”‚
â”‚  â”‚  â†’ Git â†’ Analyzer â†’ Context â†’ Prompt â†’ AI â†’ Changelog   â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚                             â”‚                                   â”‚
â”‚                             â–¼                                   â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚ Stage 2: Polish (optional, refine language)             â”‚  â”‚
â”‚  â”‚  â†’ Polish Prompt â†’ Polish AI â†’ Polished Changelog       â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### Project Structure

```
promptext-notes/
â”œâ”€â”€ cmd/
â”‚   â””â”€â”€ promptext-notes/     # CLI entry point & flag parsing
â”‚
â”œâ”€â”€ internal/
â”‚   â”œâ”€â”€ ai/                  # AI provider clients (OpenAI, Anthropic, Cerebras, etc.)
â”‚   â”œâ”€â”€ analyzer/            # Commit categorization (feat/fix/docs/etc.)
â”‚   â”œâ”€â”€ config/              # Configuration file handling
â”‚   â”œâ”€â”€ context/             # Code context extraction with Promptext
â”‚   â”œâ”€â”€ generator/           # Release notes formatting (Keep a Changelog, etc.)
â”‚   â”œâ”€â”€ git/                 # Git operations (log, diff, changed files)
â”‚   â”œâ”€â”€ prompt/              # AI prompt generation
â”‚   â””â”€â”€ workflow/            # Workflow orchestration (discovery + polish)
â”‚
â”œâ”€â”€ .github/workflows/
â”‚   â”œâ”€â”€ ci.yml               # CI/CD pipeline (tests, lint, coverage)
â”‚   â””â”€â”€ auto-docs.yml        # Automated release notes generation
â”‚
â”œâ”€â”€ docs/
â”‚   â”œâ”€â”€ README.md            # This file
â”‚   â”œâ”€â”€ USAGE.md             # User guide (install, config, usage)
â”‚   â””â”€â”€ CONFIGURATION.md     # Config file reference
â”‚
â”œâ”€â”€ .promptext-notes.yml     # Tool's own configuration
â””â”€â”€ CHANGELOG.md             # Generated by the tool itself!
```

### Core Components

#### 1. Git Analysis (`internal/git/`)

Extracts commit history and code changes:
- `GetCommitRange()` - Get commits between two tags
- `GetChangedFiles()` - Get list of files changed
- `GetDiff()` - Get full diff of changes

#### 2. Commit Categorization (`internal/analyzer/`)

Categorizes commits using conventional commit format:
- `feat:` â†’ Added
- `fix:` â†’ Fixed
- `docs:` â†’ Docs
- `refactor:`, `perf:` â†’ Changed
- `BREAKING CHANGE` â†’ Breaking

#### 3. Code Context Extraction (`internal/context/`)

Uses [Promptext](https://github.com/stacklok/promptext) to extract relevant code snippets from changed files.

#### 4. AI Providers (`internal/ai/`)

Unified interface for multiple AI providers:
- Anthropic (Claude Sonnet 4.5, Haiku 4.5)
- OpenAI (GPT-4o, GPT-4o-mini)
- Cerebras (Llama 3.3-70b, GLM-4.6)
- Groq (Llama 3.3-70b-versatile)
- OpenRouter (100+ models)
- Ollama (local models)

#### 5. 2-Stage Polish Workflow (`internal/workflow/`)

Two-stage approach for premium quality:

**Stage 1: Discovery**
- Uses technical model (e.g., GLM-4.6) to analyze code changes
- Generates accurate technical changelog
- FREE with Cerebras

**Stage 2: Polish** (optional)
- Uses language model (e.g., Claude Sonnet 4.5) to refine wording
- Adds BREAKING CHANGES categorization
- Improves readability
- ~$0.004/run with Claude Sonnet

#### 6. Auto-Exclude-Meta Filtering (`internal/config/`)

v0.8.0 feature that auto-excludes meta files from AI context:
- `.github/**` - GitHub Actions, workflows
- `CHANGELOG.md`, `README.md` - Documentation
- `.promptext-notes*.yml` - Tool configs
- `**/.gitignore` - Ignore files
- `*.example.*` - Example files

**Purpose:** Keeps changelogs focused on user-facing code changes.

### Development Workflow

#### Running Locally

```bash
# Build
go build -o promptext-notes ./cmd/promptext-notes

# Run
./promptext-notes --generate --version v1.0.0

# Run tests
go test ./...

# Run tests with coverage
go test ./... -cover

# Lint
go vet ./...
staticcheck ./...
```

#### Adding a New AI Provider

1. **Add provider client** in `internal/ai/`:
   ```go
   func CallNewProvider(ctx context.Context, prompt string, apiKey string, model string) (string, error) {
       // Implementation
   }
   ```

2. **Update config** in `internal/config/config.go`:
   ```go
   case "newprovider":
       return "NEWPROVIDER_API_KEY"
   ```

3. **Add default model** in `getDefaultModel()`:
   ```go
   case "newprovider":
       return "default-model-name"
   ```

4. **Update workflow** in `internal/workflow/workflow.go`:
   ```go
   case "newprovider":
       response, err = ai.CallNewProvider(ctx, prompt, apiKey, model)
   ```

5. **Add tests** in `internal/ai/newprovider_test.go`

6. **Update docs** in `docs/CONFIGURATION.md` and `docs/USAGE.md`

#### Adding a New Feature

1. **Write tests first** (TDD)
2. **Implement feature**
3. **Update config schema** (if needed)
4. **Update CLI flags** (if needed)
5. **Update docs**
6. **Update CHANGELOG**

### Testing

#### Unit Tests

```bash
# Run all tests
go test ./...

# Run specific package
go test ./internal/analyzer -v

# Run with coverage
go test ./... -coverprofile=coverage.out
go tool cover -html=coverage.out
```

#### Integration Tests

```bash
# Test with real API (requires API key)
export CEREBRAS_API_KEY="your-key"
go test ./internal/workflow -v -run TestWorkflow

# Test config loading
go test ./internal/config -v
```

#### Pre-commit Hooks

The repo uses pre-commit hooks (`.pre-commit-config.yaml`):
- `go fmt` - Format code
- `go vet` - Static analysis
- `staticcheck` - Additional linting
- `gocyclo` - Complexity analysis
- `go test` - Run all tests

Install hooks:
```bash
pip install pre-commit
pre-commit install
```

### Code Quality Standards

- **Test Coverage**: Aim for > 80%
- **Cyclomatic Complexity**: < 15 per function
- **Go Version**: 1.22+
- **Linting**: Pass `go vet` and `staticcheck`
- **Formatting**: Use `gofmt`

### Release Process

1. **Update version** in relevant files
2. **Update CHANGELOG** (automated via the tool itself!)
3. **Create git tag**: `git tag v1.0.0`
4. **Push tag**: `git push origin v1.0.0`
5. **GitHub Action runs** automatically:
   - Generates AI-enhanced release notes
   - Creates GitHub release
   - Updates CHANGELOG.md
   - Commits changes back to main

### Documentation

- **User docs**: `docs/USAGE.md`, `docs/CONFIGURATION.md`
- **Code docs**: Godoc comments in code
- **Examples**: `docs/USAGE.md#examples`
- **Architecture**: This file

### Contributing

1. **Fork** the repository
2. **Create** a feature branch: `git checkout -b feature/my-feature`
3. **Make** your changes
4. **Test** thoroughly: `go test ./...`
5. **Commit** with conventional commits: `feat: add new feature`
6. **Push** and create a **Pull Request**

---

## Roadmap

### v0.9.0 (Planned)

- [ ] Commit message filtering (opt-in)
- [ ] `[skip-changelog]` tag support
- [ ] Interactive mode for manual review
- [ ] Custom templates support

### v1.0.0 (Future)

- [ ] Semantic version auto-detection
- [ ] Multi-language support (non-English changelogs)
- [ ] Plugin system for custom processors
- [ ] Web UI for changelog preview

---

## Need Help?

- **Usage Questions**: See [USAGE.md](USAGE.md)
- **Config Help**: See [CONFIGURATION.md](CONFIGURATION.md)
- **Bug Reports**: [GitHub Issues](https://github.com/1broseidon/promptext-notes/issues)
- **Feature Requests**: [GitHub Discussions](https://github.com/1broseidon/promptext-notes/discussions)
- **Pull Requests**: Always welcome!

---

## License

MIT - See [LICENSE](../LICENSE) for details
